webpackJsonp([184],{iTwr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Gu7T"),i=s.n(a),r=s("Dd8w"),n=s.n(r),c=s("NYxO"),o=s("Cz8s"),l=s("deIj"),h={data:function(){return{sid:0,categorys:{},categorys_new:{},reserves:{},reserves_new:{},days:[],year:"",tables_info:{},extra:{dayIndex:0,day:"",time:"",cid:"",showPopupSearch:!1,SearchCategoryId:"-1",SearchCategoryItem:"全部桌型",searchType:"",SearchTime:"全部时间"},showPreLoading:!0}},components:{PublicHeader:o.a},methods:n()({},Object(c.b)(["setState"]),{onLoad:function(){var t=this;Object(l.a)({vue:t,url:"wmall/store/reserve/index",data:{sid:t.sid},success:function(e){t.showPreLoading=!1,t.categorys=e.categorys,t.categorys_new=e.categorys,t.reserves=e.reserves,t.reserves_new=e.reserves,t.days=[].concat(i()(e.days)),t.year=e.year,t.extra.day=t.year+"-"+t.days[0].day,t.tables_info=e.tables_info}})},onSelectDay:function(t,e){this.extra.dayIndex=t,this.extra.day=this.year+"-"+e,this.setState({type:"reserveExtra",key:"day",val:this.extra.day})},onSelectTime:function(t,e,s){return-1==t?(this.$toast("该时间不能预定点餐"),!1):this.tables_info[this.extra.day]&&this.tables_info[this.extra.day][e]&&s<=this.tables_info[this.extra.day][e][t]?(this.$toast("该桌台类型下没有可以预订的桌位"),!1):(0==this.extra.dayIndex&&(this.extra.day=this.year+"-"+this.days[0].day,this.setState({type:"reserveExtra",key:"day",val:this.extra.day})),this.extra.time=t,this.extra.cid=e,this.setState({type:"reserveExtra",key:"cid",val:e}),this.setState({type:"reserveExtra",key:"time",val:t}),void this.$router.push(this.util.getUrl({path:"/tangshi/pages/reserve/create?sid="+this.sid})))},onChangeSearch:function(t){this.extra.searchType=t,this.extra.showPopupSearch=!this.extra.showPopupSearch},onChangeSearchType:function(t){this.extra.searchType!=t&&(this.extra.searchType=t)},onChangeCategory:function(t,e){"-1"==e?(this.reserves_new={},this.reserves_new=this.reserves,this.categorys_new=this.categorys,this.extra.SearchCategoryItem="全部桌型"):(this.reserves_new={},this.reserves_new[t]=this.reserves[t],this.categorys_new=[],this.categorys_new.push(this.categorys[e]),this.extra.SearchCategoryItem=this.categorys[e].title),this.extra.SearchCategoryId=t,this.extra.SearchTime="全部时间",this.extra.showPopupSearch=!this.extra.showPopupSearch},onChangeTimes:function(t,e){if("-1"==e)this.reserves_new=this.reserves;else{if("-1"==this.extra.SearchCategoryId)var s=this.categorys[0].id;else s=this.extra.SearchCategoryId;var a=this.reserves[s][e];this.reserves_new={},this.reserves_new[s]=[],this.reserves_new[s].push(a)}this.extra.SearchTime=t,this.extra.showPopupSearch=!this.extra.showPopupSearch}}),mounted:function(){this.onLoad()},created:function(){this.query=this.$route.query,this.query&&(this.sid=this.query.sid)}},d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"reserve-yuding"}},[s("public-header",{attrs:{title:"预定"}}),t._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"yuding-header-wrap"},[s("div",{staticClass:"yuding-header"},t._l(t.days,function(e,a){return s("div",{key:a,staticClass:"yuding-date",class:{active:a==t.extra.dayIndex},on:{click:function(s){return t.onSelectDay(a,e.day)}}},[s("div",[t._v(t._s(e.day_cn))]),t._v(" "),s("div",{staticClass:"padding-5-t"},[t._v(t._s(e.day)+" "+t._s(e.week_cn))])])}),0),t._v(" "),s("div",{staticClass:"yuding-filter van-hairline--top"},[s("div",{staticClass:"filter-item",on:{click:function(e){return t.onChangeSearch("tables")}}},[t._v(t._s(t.extra.SearchCategoryItem)+" "),s("i",{staticClass:"icon icon-unfold"})]),t._v(" "),s("div",{staticClass:"filter-item",on:{click:function(e){return t.onChangeSearch("times")}}},[t._v(t._s(t.extra.SearchTime)+" "),s("i",{staticClass:"icon icon-unfold"})]),t._v(" "),s("div",{staticClass:"filter-item",on:{click:function(e){return t.onChangeSearch("discounts")}}},[t._v("全部折扣 "),s("i",{staticClass:"icon icon-unfold"})])])]),t._v(" "),s("div",{staticClass:"tables-list"},t._l(t.categorys_new,function(e){return s("div",{key:e.id},t._l(t.reserves_new[e.id],function(a){return s("div",{key:a.title,staticClass:"tables-item"},[s("div",{staticClass:"tables-left"},[s("div",{staticClass:"tables-info"},[s("div",{staticClass:"tables-time"},[t._v(t._s(a.title))]),t._v(" "),s("div",{staticClass:"tables-date"},[t._v(t._s(t.days[t.extra.dayIndex].day_cn))]),t._v(" "),s("div",{staticClass:"font-14"},[t._v(t._s(e.title))])]),t._v(" "),s("div",{staticClass:"flex"},[t.tables_info[t.extra.day]?[t.tables_info[t.extra.day][e.id]?[t.tables_info[t.extra.day][e.id][a.time]?[s("div",{staticClass:"tables-bar"},[s("div",{staticClass:"bar-inner",style:{width:t.tables_info[t.extra.day][e.id][a.time]/a.total_num*100+"%"}})]),t._v(" "),a.total_num?[s("div",{staticClass:"tables-text"},[t._v("剩"+t._s(a.total_num-t.tables_info[t.extra.day][e.id][a.time])+"桌")])]:[s("div",{staticClass:"tables-text"},[t._v("剩0桌")])]]:[t._m(0,!0),t._v(" "),s("div",{staticClass:"tables-text"},[t._v("剩"+t._s(a.total_num)+"桌")])]]:[t._m(1,!0),t._v(" "),s("div",{staticClass:"tables-text"},[t._v("剩"+t._s(a.total_num)+"桌")])]]:[t._m(2,!0),t._v(" "),s("div",{staticClass:"tables-text"},[t._v("剩"+t._s(a.total_num)+"桌")])]],2)]),t._v(" "),s("div",{staticClass:"tables-right flex"},[0==t.extra.dayIndex&&1==a.timeout||t.extra.dayIndex>0?[s("div",{staticClass:"btn-tables",on:{click:function(s){return t.onSelectTime(a.time,e.id,a.total_num)}}},[t._v("预订")])]:[s("div",{staticClass:"btn-tables border-gray",on:{click:function(e){return t.onSelectTime(-1,-1,0)}}},[t._v("预订")])]],2)])}),0)}),0)]),t._v(" "),t.showPreLoading?s("iloading"):t._e(),t._v(" "),s("van-popup",{staticClass:"popup-search",attrs:{position:"top"},model:{value:t.extra.showPopupSearch,callback:function(e){t.$set(t.extra,"showPopupSearch",e)},expression:"extra.showPopupSearch"}},[s("div",{staticClass:"search-btn-tab van-hairline--bottom"},[s("div",{staticClass:"search-btn-item",class:{active:"tables"==t.extra.searchType},on:{click:function(e){return t.onChangeSearchType("tables")}}},[t._v("全部桌型")]),t._v(" "),s("div",{staticClass:"search-btn-item",class:{active:"times"==t.extra.searchType},on:{click:function(e){return t.onChangeSearchType("times")}}},[t._v("全部时间")]),t._v(" "),s("div",{staticClass:"search-btn-item",class:{active:"discounts"==t.extra.searchType},on:{click:function(e){return t.onChangeSearchType("discounts")}}},[t._v("全部折扣")])]),t._v(" "),"tables"==t.extra.searchType?[s("div",{staticClass:"search-alltable"},[s("div",{staticClass:"new-search-group"},[s("div",{staticClass:"new-search-item",on:{click:function(e){return t.onChangeCategory(-1,-1)}}},[s("div",{staticClass:"info",class:{active:"-1"==t.extra.SearchCategoryId}},[t._v("全部桌型")])]),t._v(" "),t._l(t.categorys,function(e,a){return s("div",{key:a,staticClass:"new-search-item",on:{click:function(s){return t.onChangeCategory(e.id,a)}}},[s("div",{staticClass:"info",class:{active:t.extra.SearchCategoryId==e.id}},[t._v(t._s(e.title))])])})],2)])]:"times"==t.extra.searchType?[s("div",{staticClass:"search-alltable"},[s("div",{staticClass:"new-search-group"},[s("div",{staticClass:"new-search-item",on:{click:function(e){return t.onChangeTimes("全部时间",-1)}}},[s("div",{staticClass:"info",class:{active:"全部时间"==t.extra.SearchTime}},[t._v("全部时间")])]),t._v(" "),"-1"==t.extra.SearchCategoryId?t._l(t.reserves[t.categorys[0].id],function(e,a){return s("div",{key:a,staticClass:"new-search-item",on:{click:function(s){return t.onChangeTimes(e.time,a)}}},[s("div",{staticClass:"info",class:{active:t.extra.SearchTime==e.time}},[t._v(t._s(e.time))])])}):t._l(t.reserves[t.extra.SearchCategoryId],function(e,a){return s("div",{key:a,staticClass:"new-search-item",on:{click:function(s){return t.onChangeTimes(e.time,a)}}},[s("div",{staticClass:"info",class:{active:t.extra.SearchTime==e.time}},[t._v(t._s(e.time))])])})],2)])]:"discounts"==t.extra.searchType?[s("div",{staticClass:"search-alltable"},[s("div",{staticClass:"new-search-group"},[s("div",{staticClass:"new-search-item"},[s("div",{staticClass:"info active"},[t._v("全部折扣")])])])])]:t._e()],2)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tables-bar"},[e("div",{staticClass:"bar-inner",staticStyle:{width:"0%"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tables-bar"},[e("div",{staticClass:"bar-inner",staticStyle:{width:"0%"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tables-bar"},[e("div",{staticClass:"bar-inner",staticStyle:{width:"0%"}})])}]};var v=s("VU/8")(h,d,!1,function(t){s("n7Fb")},null,null);e.default=v.exports},n7Fb:function(t,e){}});