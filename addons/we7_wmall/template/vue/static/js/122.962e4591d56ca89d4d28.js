webpackJsonp([122],{"8v2p":function(t,e){},pZWh:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Gu7T"),i=s.n(a),n=s("Cz8s"),l=s("q0vl"),c={data:function(){return{preLoading:!0,canBuy:!0,mealRedpacketId:0,params:{},style:{},redpackets:[],usefulNum:0,exchanges:{page:2,psize:15,loading:!1,finished:!1,data:[]},islegal:!1,popupShow:!1,selectedRedpacketId:0,selectedSid:0,agreementShow:!1,agreementContent:""}},components:{PublicHeader:n.a,agreement:l.a},methods:{onLoad:function(){var t=this;this.util.request({url:"mealRedpacket/meal/index"}).then(function(e){t.preLoading=!1;var s=e.data.message;if(s.errno)t.util.$toast(s.message);else{if(0==s.message.mealRedpacket)return t.util.$toast("暂无套餐红包活动"),!1;t.canBuy=s.message.canBuy,t.usefulNum=s.message.useful_num,t.redpackets=[].concat(i()(t.redpackets),i()(s.message.redpackets)),t.exchanges.data=[].concat(i()(t.exchanges),i()(s.message.exchanges)),s.message.exchanges.length<t.exchanges.psize&&(t.exchanges.finished=!0);var a=s.message.mealRedpacket;t.agreementContent=a.data.rules,t.mealRedpacketId=a.id,t.params=a.data.params,t.style=a.data.style,t.islegal=!0}})},onGetExchanges:function(){var t=this;if(this.exchanges.finished)return!1;this.util.request({url:"mealRedpacket/meal/exchange",data:{page:this.exchanges.page,psize:this.exchanges.psize,mealRedpacket_id:this.mealRedpacketId}}).then(function(e){var s=e.data.message;if(s.errno)t.util.$toast(s.message);else{t.exchanges.loading=!1;var a=s.message.exchanges;t.exchanges.data=[].concat(i()(t.exchanges.data),i()(a)),a.length<t.exchanges.psize&&(t.exchanges.finished=!0),t.exchanges.page++}})},onSubmit:function(){var t=this;if(!this.islegal)return!1;if(this.islegal=!1,!this.canBuy)return this.uitl.$toast("本月购买次数已用完"),!1;var e={mealRedpacket_id:parseInt(this.mealRedpacketId),final_fee:parseFloat(this.params.price)};this.util.request({url:"mealRedpacket/meal/submit",data:e}).then(function(e){var s=e.data.message;if(s.errno)t.util.$toast(s.message);else{var a=s.message;t.$router.replace(t.util.getUrl({path:"/pages/public/pay?order_id="+a+"&order_type=mealRedpacket"}))}})},onExchangePopupShow:function(t){return 1==this.params.exchangeStatus&&(this.canBuy?(this.util.$toast("请购买套餐红包后再进行兑换操作"),!1):(this.selectedSid=t,void this.onTogglePopup()))},onTogglePopup:function(){this.popupShow=!this.popupShow},onToggleAgreement:function(){this.agreementShow=!this.agreementShow},onSelectRedpacket:function(t){return 1!=t.status?(this.util.$toast("请选择有效的红包进行兑换"),!1):t.sid>0?(this.util.$toast("无法使用已兑换的红包进行兑换"),!1):void(this.selectedRedpacketId=t.id)},onExchange:function(){var t=this,e={redpacket_id:parseInt(this.selectedRedpacketId),sid:parseInt(this.selectedSid),mealRedpacket_id:parseInt(this.mealRedpacketId)};this.util.request({url:"mealRedpacket/meal/do_exchange",data:e}).then(function(e){var s=e.data.message;t.util.$toast(s.message),s.errno||window.location.reload()})}},mounted:function(){this.onLoad()}},o={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"mealRedpacket-plus"}},[t.isWeixin?t._e():s("public-header",{attrs:{title:"红包套餐"}}),t._v(" "),t.mealRedpacketId>0?s("div",{staticClass:"content"},[s("div",{staticClass:"info"},[s("div",{staticClass:"city-records flex-lr"},[s("div",{staticClass:"city flex"},[t._e()],2),t._v(" "),s("router-link",{staticClass:"records flex",attrs:{tag:"div",to:t.util.getUrl({path:"/package/pages/mealRedpacket/ordermeal"})}},[s("img",{attrs:{src:"static/img/meal/meal_time.png",alt:""}}),t._v(" "),s("span",[t._v("购买记录")])])],1),t._v(" "),s("div",{staticClass:"meal-info",style:{background:"url("+t.params.backgroundImage+") no-repeat top left/100% 100%"}},[s("div",{staticClass:"tip flex",style:{color:t.style.rulesColor}},[s("span",{staticClass:"icon icon-question1",on:{click:t.onToggleAgreement}}),t._v(" "),s("span",{on:{click:t.onToggleAgreement}},[t._v("特权说明")])]),t._v(" "),s("div",{staticClass:"title",style:{color:t.style.titleColor}},[t._v(t._s(t.params.title))]),t._v(" "),s("div",{staticClass:"contain",style:{color:t.style.placeholderColor}},[t._v(t._s(t.params.placeholder))]),t._v(" "),t.canBuy?s("div",{staticClass:"btn-buy haved ",class:{disabled:!t.islegal},style:{color:t.style.btnColor,background:t.style.btnBackground},on:{click:function(e){t.onSubmit()}}},[s("span",{staticClass:"renminbi font-12"},[t._v("¥")]),t._v(" "),s("span",{staticClass:"price font-18 padding-10-r"},[t._v(t._s(t.params.price))]),t._v(" "),s("span",[t._v(t._s(t.params.btnText))])]):s("div",{staticClass:"btn-buy"},[t._v("本月购买次数已用完")])]),t._v(" "),t.params.tips?s("div",{staticClass:"use-limit flex-lr"},t._l(t.params.tips,function(e,a){return s("div",{key:a,staticClass:"limit-item"},[s("div",{staticClass:"img"},[s("img",{attrs:{src:e.imgurl,alt:""}})]),t._v(" "),s("span",{staticClass:"text ellipsis",style:{color:e.color}},[t._v(t._s(e.text))])])})):t._e()]),t._v(" "),s("div",{staticClass:"detail"},[t.redpackets&&t.redpackets.length>0?[t.canBuy?t._e():s("div",{staticClass:"title flex-lr padding-10-lr padding-10-t"},[s("div",{staticClass:"avail-num"},[s("span",[t._v("可用"+t._s(t.usefulNum)+"个红包")])]),t._v(" "),t._e()]),t._v(" "),s("div",{staticClass:"redpacket-list"},[s("van-row",{attrs:{gutter:"10"}},t._l(t.redpackets,function(e,a){return s("van-col",{key:a,staticClass:"margin-10-b",attrs:{span:"12"}},[s("div",{staticClass:"redpacket-item",class:{used:e.status>1}},[s("div",{staticClass:"top"},[s("div",{staticClass:"flex-lr"},[s("div",{staticClass:"name"},[t._v(t._s(e.name))]),t._v(" "),s("div",{staticClass:"price color-main"},[t._v("\n\t\t\t\t\t\t\t\t\t\t\t¥"),s("span",{staticClass:"font-20"},[t._v(t._s(e.discount))])])]),t._v(" "),s("div",{staticClass:"flex-lr margin-10-tb"},[s("div",{staticClass:"useday-limit"},[t._v("有效期: "+t._s(e.use_days_limit)+"天")]),t._v(" "),e.condition>0?s("p",{staticClass:"color-main"},[t._v("满"+t._s(e.condition)+"元")]):s("p",{staticClass:"color-main"},[t._v("无门槛")])])]),t._v(" "),t.canBuy?s("div",{staticClass:"bottom"},[t._v("购买后即可享受优惠")]):s("div",{staticClass:"bottom"},[t._v(t._s(e.endtime_cn))])])])}))],1)]:t._e(),t._v(" "),1==t.params.exchangeStatus&&t.exchanges.data.length>0?[t._m(0),t._v(" "),s("div",{staticClass:"exchange-list padding-10"},[s("van-list",{attrs:{finished:t.exchanges.finished,offset:100,"immediate-check":!1},on:{load:t.onGetExchanges},model:{value:t.exchanges.loading,callback:function(e){t.$set(t.exchanges,"loading",e)},expression:"exchanges.loading"}},t._l(t.exchanges.data,function(e,a){return s("div",{key:a,staticClass:"exchange-item"},[s("div",{staticClass:"exchange-item-wrap "},[s("div",{staticClass:"store"},[s("div",{staticClass:"store-name ellipsis"},[t._v(t._s(e.title))]),t._v(" "),s("div",{staticClass:"flex margin-10-t"},[s("van-rate",{attrs:{size:12,"disabled-color":"#ff2d4b",disabled:""},model:{value:e.score,callback:function(s){t.$set(e,"score",s)},expression:"item.score"}}),t._v(" "),s("p",{staticClass:"star"},[t._v(t._s(e.score))])],1),t._v(" "),e.activity?s("div",{staticClass:"activity flex margin-10-t"},[s("img",{attrs:{src:"static/img/icon-discount.png",alt:""}}),t._v(" "),s("p",{staticClass:"ellipsis"},[t._v(t._s(e.activity))])]):t._e()]),t._v(" "),s("div",{staticClass:"price"},[t._v("\n\t\t\t\t\t\t\t\t\t¥"),s("span",[t._v(t._s(e.discount))]),t._v(" "),e.condition>0?s("p",{staticClass:"ellipsis"},[t._v("满"+t._s(e.condition)+"元")]):s("p",{staticClass:"ellipsis"},[t._v("无门槛")])])]),t._v(" "),s("div",{staticClass:"exchange",on:{click:function(s){t.onExchangePopupShow(e.store_id)}}},[s("span",[t._v("立")]),s("span",[t._v("即")]),s("span",[t._v("兑")]),s("span",[t._v("换")])])])}))],1)]:t._e()],2)]):t._e(),t._v(" "),s("van-popup",{staticClass:"popup-exchange",attrs:{position:"bottom"},model:{value:t.popupShow,callback:function(e){t.popupShow=e},expression:"popupShow"}},[s("div",{staticClass:"popup-title van-hairline--bottom"},[t._v("请选择一个可用红包进行兑换")]),t._v(" "),s("div",{staticClass:"popup-container"},[s("div",{staticClass:"redpacket-list"},[s("van-row",{attrs:{gutter:"10"}},t._l(t.redpackets,function(e,a){return s("van-col",{key:a,staticClass:"margin-10-b",attrs:{span:"12"}},[s("div",{staticClass:"redpacket-item",class:{active:e.id==t.selectedRedpacketId,used:e.status>1||e.sid>0},on:{click:function(s){t.onSelectRedpacket(e)}}},[s("div",{staticClass:"top"},[s("div",{staticClass:"flex-lr"},[s("div",{staticClass:"name"},[t._v(t._s(e.name))]),t._v(" "),s("div",{staticClass:"price color-main"},[t._v("\n\t\t\t\t\t\t\t\t\t\t¥"),s("span",{staticClass:"font-20"},[t._v(t._s(e.discount))])])]),t._v(" "),s("div",{staticClass:"flex-lr margin-10-tb"},[s("div",{staticClass:"useday-limit"},[t._v("有效期: "+t._s(e.use_days_limit)+"天")]),t._v(" "),e.condition>0?s("p",{staticClass:"color-main"},[t._v("满"+t._s(e.condition)+"元")]):s("p",{staticClass:"color-main"},[t._v("无门槛")])])]),t._v(" "),t.canBuy?s("div",{staticClass:"bottom"},[t._v("购买后即可享受优惠")]):s("div",{staticClass:"bottom"},[t._v(t._s(e.endtime_cn))])])])}))],1)]),t._v(" "),s("div",{staticClass:"popup-confirm van-hairline--top text-center c-danger",on:{click:function(e){t.onExchange()}}},[t._v("确定兑换")])]),t._v(" "),s("agreement",{attrs:{show:t.agreementShow,title:"特权说明",content:t.agreementContent},on:{agreementHide:t.onToggleAgreement}}),t._v(" "),s("iloading",{directives:[{name:"show",rawName:"v-show",value:t.preLoading,expression:"preLoading"}]})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title padding-10-lr"},[e("div",{staticClass:"avail-num"},[e("span",[this._v("可兑换大额商家红包")])]),this._v(" "),e("div",{staticClass:"tips margin-10-t"},[this._v("*每兑换1个商家红包，将使用1个红包套餐内的通用红包")])])}]};var r=s("VU/8")(c,o,!1,function(t){s("8v2p")},null,null);e.default=r.exports}});
//# sourceMappingURL=122.962e4591d56ca89d4d28.js.map