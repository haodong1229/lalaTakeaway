webpackJsonp([165],{M44L:function(t,a){},kYuw:function(t,a,i){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=i("Gu7T"),e=i.n(o),d=i("mvHQ"),s=i.n(d),n=i("woOf"),r=i.n(n),l=i("Dd8w"),c=i.n(l),u=i("NYxO"),y=i("Cz8s"),h=i("mzkE"),f=i("fgl9"),g=i("kEnp"),_={name:"diyIndex",data:function(){return{title:"",id:0,getLocationFail:!1,showPreLoading:!0,styleContent:"#fff",diydata:{diy:{data:{}},storeExtra:{condition:{order:"",mode:"",dis:""},filter_title:"综合排序",multiple:!1,filter:!1},stores:{loading:!0,finished:!1,page:1,psize:20,loaded:0,empty:0,data:[]},popup:{storeSearch:!1},superRedpacketData:{},guideData:{is_show:!1}},menufooter:{},follow:{},followShow:!1}},components:{PublicHeader:y.a,PublicFooter:h.a,diy:g.a,follow:f.a},watch:{$route:function(){this.id=this.$route.query.id},id:function(){this.onLoad(!0)}},methods:c()({},Object(u.b)(["setLocation","getLocation","setState"]),{onToggleDiscount:function(t,a){"waimai_stores"==this.diydata.diy.data.items[a].id?this.diydata.diy.data.items[a].data[t].activity.is_show_all=!this.diydata.diy.data.items[a].data[t].activity.is_show_all:this.diydata.stores.data[t].activity.is_show_all=!this.diydata.stores.data[t].activity.is_show_all,this.diydata=r()({},this.diydata)},onCloseRedpacket:function(){this.diydata.superRedpacketData.is_show=!1,this.diydata.superRedpacketData=r()({},this.diydata.superRedpacketData)},onChangeStoreExtra:function(t){"multiple"==t?(this.diydata.storeExtra.multiple=!0,this.diydata.storeExtra.filter=!1):(this.diydata.storeExtra.multiple=!1,this.diydata.storeExtra.filter=!0),this.diydata.popup.storeSearch=!0},onStoreOrderby:function(t,a,i){if("order"==t)this.diydata.storeExtra.condition.order=a,this.diydata.storeExtra.multiple=!1,this.diydata.storeExtra.filter_title="sailed"!=a&&"distance"!=a?i:"综合排序";else{if("discounts"==t)return this.diydata.storeExtra.condition.dis==a&&(a=""),this.diydata.storeExtra.condition.dis=a,!1;if("mode"==t)return this.diydata.storeExtra.condition.mode==a&&(a=""),this.diydata.storeExtra.condition.mode=a,!1;"clear"==t?(this.diydata.storeExtra.condition.dis="",this.diydata.storeExtra.condition.order="",this.diydata.storeExtra.condition.mode="",this.diydata.storeExtra.filter=!1,this.diydata.storeExtra.filter_title="综合排序"):"finish"==t&&(this.diydata.storeExtra.filter=!1)}this.diydata.popup.storeSearch=!1,this.onGetStore(!0)},onGetStore:function(t){var a=this,i=this;t&&(i.diydata.stores={page:1,psize:20,loaded:0,empty:!1,loading:!0}),i.diydata.stores.loading=!0,this.util.request({url:"wmall/home/index/store",data:{lat:i.locationInfo.location_x,lng:i.locationInfo.location_y,page:i.diydata.stores.page,psize:i.diydata.stores.psize,condition:s()(i.diydata.storeExtra.condition)}}).then(function(o){var d=o.data.message.message;t&&(i.diydata.stores.data=[]),i.diydata.stores.data=[].concat(e()(a.diydata.stores.data),e()(d.stores)),d.pagetotal<=i.diydata.stores.page&&(i.diydata.stores.loaded=1,i.diydata.stores.data.length||(i.diydata.stores.empty=!0),i.diydata.stores.finished=!0),i.diydata.stores.loading=!1,i.diydata.stores.page++,i.diydata.stores.loaded||d.stores.length||a.onGetStore()})},onLoad:function(){var t=this,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.util.request({url:"diypage/diy",data:{id:this.id,menufooter:1}}).then(function(i){var o=t;o.showPreLoading=!1;var e=i.data.message;if(e.errno)o.util.$toast(e.message);else{if(o.diydata.config=e.message.config,o.diydata.diy.guide)if(1==o.diydata.diy.guide.params.status&&"interval"==o.diydata.diy.guide.params.show_setting){var d=t.util.getStorage("guideStorage");(!d||d&&!d.show)&&(t.util.setStorage("guideStorage",{show:1},60*o.diydata.diy.guide.params.interval_time),o.diydata.guideData.is_show=!0)}else 1==o.diydata.diy.guide.params.status&&"everytime"==o.diydata.diy.guide.params.show_setting&&(t.util.removeStorage("guideStorage"),o.diydata.guideData.is_show=!0);o.diydata.diy=e.message.diy,o.diy=e.message.diy,o.title=e.message.diy.data.page.title,o.util.setWXTitle(o.title),o.diydata.superRedpacketData=e.message.superRedpacketData,o.diydata.superRedpacketData.is_show=!0,o.diydata.cart_sum=e.message.cart_sum,o.menufooter=window.menufooter,o.follow=window.follow,1==o.diy.data.page.followbar&&o.follow&&1==o.follow.status&&(o.followShow=!0),o.styleContent={"background-color":t.diydata.diy.data.page.background},1==o.diy.is_show_kefu&&o.util.imeiqia(),1!=o.diy.is_has_location&&1!=o.diy.is_has_allstore||(o.getLocation(),o.locationInfo.location_x?(o.getLocationFail=!1,o.onGetStore(a)):o.util.getLocation({successLocation:function(t){o.setLocation({last_location_x:t.location_x,location_x:t.location_x,location_y:t.location_y}),1==o.diy.is_has_allstore&&o.onGetStore(a)},successAddress:function(t){o.setLocation({last_location_x:t.location_x,location_x:t.location_x,location_y:t.location_y,address:t.address})},fail:function(t){o.setLocation({last_location_x:0,location_x:0,address:"获取定位失败"}),o.getLocationFail=!0,1==o.diy.is_has_allstore&&o.onGetStore(a)}}))}})},onGetCartNums:function(){var t=this;this.util.request({url:"wmall/home/index/cart"}).then(function(a){var i=a.data.message;i.errno?t.util.$toast(i.message):t.diydata.cart_sum=i.message.cart_sum})},onCloseGuide:function(){this.diydata.guideData.is_show=!1}}),created:function(){this.$route.query.id?this.id=this.$route.query.id:this.util.$toast("页面不存在！")},computed:c()({},Object(u.c)(["locationInfo"])),activated:function(){if(this.locationInfo.last_location_x!=this.locationInfo.location_x)return this.diydata.storeExtra={condition:{order:"",mode:"",dis:""},filter_title:"综合排序",multiple:!1,filter:!1},void this.onLoad(!0);this.onGetCartNums()},mounted:function(){}},m={render:function(){var t=this,a=t.$createElement,i=t._self._c||a;return i("div",{attrs:{id:"diy"}},[t.followShow?i("follow",{attrs:{follow:t.follow}}):t._e(),t._v(" "),t.isWeixin?t._e():i("public-header",{attrs:{title:t.title}}),t._v(" "),t.menufooter?i("public-footer",{attrs:{menufooter:t.menufooter}}):t._e(),t._v(" "),i("div",{staticClass:"content",style:t.styleContent},[i("diy",{attrs:{diydata:t.diydata,preLoading:t.showPreLoading,getLocationFail:t.getLocationFail},on:{onToggleDiscount:t.onToggleDiscount,onChangeStoreExtra:t.onChangeStoreExtra,onStoreOrderby:t.onStoreOrderby,onGetStore:t.onGetStore,onCloseRedpacket:t.onCloseRedpacket,onCloseGuide:t.onCloseGuide}})],1)],1)},staticRenderFns:[]};var p=i("VU/8")(_,m,!1,function(t){i("M44L")},null,null);a.default=p.exports}});
//# sourceMappingURL=165.a7cc06702c3e3acfb204.js.map