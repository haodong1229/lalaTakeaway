webpackJsonp([2],{"2NjV":function(e,t,s){"use strict";s.d(t,"a",function(){return n});var i=s("woOf"),a=s.n(i),r=s("YaEn");function n(e){var t=e.type;if("delivery_transfer"!=t&&"direct_transfer"!=t&&"cancel"!=t){var s=function(e){return{delivery_assign:{tip:"确定抢单吗",success_status:2},direct_transfer_refuse:{tip:"确定拒绝转单吗",success_status:3,reply:"refuse"},direct_transfer_agree:{tip:"确定接受转单吗",success_status:2,reply:"agree"},delivery_instore:{tip:"确定已取货吗",success_status:3},delivery_success:{tip:"确认已送达吗",success_status:4},wx_notice:{tip:"确定通知下单人你已到达送餐地址吗",success_status:0}}[e]}(t),i=s.success_status;"direct_transfer_refuse"!=t&&"direct_transfer_agree"!=t||(t="direct_transfer_reply");var n="delivery/order/errander/status";"wx_notice"==t&&(n="delivery/order/errander/notice");var o={url:n,data:{id:e.order.id,type:t,reply:s.reply||"",code:e.code},confirm:e.code?"":s.tip,success:function(r){if(e.vue.util.$toast(r),"wx_notice"!=t){if("detail"==e.from)"direct_transfer_reply"==t?(e.vue.order.transfer_delivery_status=i,"agree"==s.reply&&(e.vue.order.deliveryer_id=e.vue.order.transfer_deliveryer_id)):e.vue.order.delivery_status=i,e.vue.order=a()({},e.vue.order);else if("agree"==s.reply)e.vue.records.data[e.index].transfer_delivery_status=i;else if("refuse"==s.reply)e.vue.records.data.splice(e.index,1);else{-1!=["delivery_assign","delivery_instore","delivery_success"].indexOf(t)&&e.vue.records.data.splice(e.index,1)}e.code&&(e.vue.code=a()({},{codeShow:!1,value:"",orderIndex:-1}))}},fail:function(t){e.vue.util.$toast(t.message),e.code&&(e.vue.code=a()({},{codeShow:!1,value:"",orderIndex:-1}))}};e.vue.util.jspost(o)}else r.a.push(e.vue.util.getUrl({path:"/pages/paotui/op",query:{order_id:e.order.id,type:t,order_status:e.order.status}}))}},"37pY":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("Cz8s"),a=s("mzkE"),r=s("75NE"),n=s("deIj"),o=s("2NjV"),c={components:{publicHeader:i.a,publicFooter:a.a,countDown:r.a},data:function(){return{tabActive:0,tabs:["待抢","待取货","配送中","已完成"],filter:{items:{status:1}},isRefresh:!1,showPreLoading:!0,records:{page:1,psize:15,loading:!1,finished:!1,empty:!1,data:[]},deliveryer:{},can_collect_order:!1,verification_code:!1,config:{},code:{codeShow:!1,value:"",orderIndex:-1},failedTips:{show:!1,type:"message",tips:"您没有跑腿单的配送权限，请联系平台管理员",btnText:"",link:"",position:"absolute"},menufooter:{}}},methods:{onChangeStatus:function(e,t){this.filter.items.status=e+1,this.onLoad(!0)},onLoad:function(e){var t=this;Object(n.b)({vue:t,force:e,url:"delivery/order/errander/list",recordsName:"orders",data:{menufooter:1},success:function(e){t.deliveryer=e.deliveryer,t.can_collect_order=e.can_collect_order,t.verification_code=e.verification_code,t.config=e.config},fail:function(){t.failedTips.show=!0}})},onChangeOrderStatus:function(e,t){("delivery_success"!=t||1!=this.verification_code||(this.code.codeShow=!0,this.code.orderIndex=e,this.code.value))&&Object(o.a)({vue:this,type:t,index:e,from:"list",order:this.records.data[e],code:this.code.value})},onDetail:function(e){1!=this.filter.items.status?this.$router.push(this.util.getUrl({path:"pages/paotui/detail",query:{id:e}})):this.util.$toast("抢单后才能查看详情","",1e3)},onPullDownRefresh:function(){this.onLoad(!0)}},mounted:function(){var e=this;e.onLoad(),setInterval(function(){1==e.filter.items.status&&1==e.config.auto_refresh&&e.onLoad(!0)},15e3),this.util.imap(),this.util.icloudapi()}},l={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"paotui-list"}},[s("public-header",{attrs:{title:"跑腿订单列表"}}),e._v(" "),s("public-footer",{attrs:{showPreLoading:e.showPreLoading,menufooter:e.menufooter}}),e._v(" "),s("div",{staticClass:"content"},[s("van-tabs",{attrs:{color:"#0EC3B3","title-active-color":"#0EC3B3","title-inactive-color":"#000","line-width":80,"line-height":2,"offset-top":46,sticky:"",swipeable:""},on:{change:e.onChangeStatus},model:{value:e.tabActive,callback:function(t){e.tabActive=t},expression:"tabActive"}},e._l(e.tabs,function(t,i){return s("van-tab",{key:i,attrs:{title:t}},[s("van-pull-refresh",{on:{refresh:function(t){e.onPullDownRefresh()}},model:{value:e.isRefresh,callback:function(t){e.isRefresh=t},expression:"isRefresh"}},[e.records.empty?s("div",{staticClass:"no-data"},[s("img",{attrs:{src:"static/img/order_no_con.png",alt:""}}),e._v(" "),1==e.filter.items.status?[1==e.deliveryer.work_status?[1==e.deliveryer.is_errander?[e.can_collect_order?[s("p",[e._v("暂无待抢的跑腿订单")])]:[s("p",[e._v("当前调度模式不允许抢单,请等待管理员或系统派单")])]]:[s("p",[e._v("您没有跑腿单配送权限，请联系管理员")])]]:[s("p",[e._v("您当前处于收工状态,不能抢单")])]]:[s("p",[e._v("暂无符合条件的跑腿订单")])]],2):s("van-list",{attrs:{finished:e.records.finished,offset:100,"immediate-check":!1},on:{load:e.onLoad},model:{value:e.records.loading,callback:function(t){e.$set(e.records,"loading",t)},expression:"records.loading"}},e._l(e.records.data,function(t,i){return s("div",{key:t.id,staticClass:"order-item"},[s("div",{staticClass:"van-hairline--bottom flex-lr padding-15-tb padding-10-lr",on:{click:function(s){e.onDetail(t.id)}}},[s("div",{staticClass:"flex"},[s("span",{staticClass:"c-primary font-500 font-18"},[e._v("#"+e._s(t.id))]),e._v(" "),s("div",{staticClass:"distance flex"},[s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"w-100",attrs:{src:"static/img/start.png",alt:""}})]),e._v(" "),s("div",{staticClass:"text"},[e._v("-"+e._s(t.store2deliveryer_distance)+"km-")]),e._v(" "),s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"w-100",attrs:{src:"static/img/ds.png",alt:""}})]),e._v(" "),s("div",{staticClass:"text"},[e._v("-"+e._s(t.store2user_distance)+"km-")]),e._v(" "),s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"w-100",attrs:{src:"static/img/end.png",alt:""}})])])]),e._v(" "),s("span",{staticClass:"c-danger font-15 font-500"},[e._v("¥ "+e._s(t.deliveryer_total_fee))])]),e._v(" "),s("div",{staticClass:"padding-10-lr margin-15-t"},[s("div",{staticClass:"flex-lr"},[s("ul",{staticClass:"order-tags"},[s("li",{staticClass:"handle-type"},[e._v(e._s(t.delivery_collect_type_cn))]),e._v(" "),e._e()]),e._v(" "),2==t.status&&1!=t.delivery_status?s("div",{staticClass:"c-danger flex"},[t.delivery_overtime>0?[e._v("\n\t\t\t\t\t\t\t\t\t\t\t距超时"),s("count-down",{staticClass:"c-danger",attrs:{endTime:t.delivery_overtime}})]:t.delivery_overtime_start>0?[e._v("\n\t\t\t\t\t\t\t\t\t\t\t已超时"),s("count-down",{staticClass:"c-danger",attrs:{startTime:t.delivery_overtime_start}})]:e._e()],2):e._e()])]),e._v(" "),s("ul",{staticClass:"address padding-10-lr",on:{click:function(s){e.onDetail(t.id)}}},[s("li",{staticClass:"flex-lr margin-15-t"},[s("span",{staticClass:"c-primary font-15"},[e._v("物:")]),e._v(" "),s("ul",{staticClass:"address-text"},[s("li",{staticClass:"font-15 font-500"},[e._v(e._s(t.goods_name))])])]),e._v(" "),s("li",{staticClass:"flex-lr margin-15-t"},[s("span",{staticClass:"c-info font-15"},[e._v(e._s("buy"==t.order_type?"买":"取")+":")]),e._v(" "),s("ul",{staticClass:"address-text"},[s("li",{staticClass:"font-15 font-500"},[e._v(e._s(t.buy_address))])])]),e._v(" "),s("li",{staticClass:"flex-lr margin-15-t"},[s("span",{staticClass:"c-primary font-15"},[e._v("送:")]),e._v(" "),s("ul",{staticClass:"address-text"},[s("li",{staticClass:"font-15 font-500 "},[e._v(e._s(t.accept_address))])])])]),e._v(" "),t.note?s("div",{staticClass:"note"},[s("div",{staticClass:"note-title"},[e._v("备注:")]),e._v(" "),s("div",{staticClass:"note-text"},[e._v(e._s(t.note))])]):e._e(),e._v(" "),s("ul",{staticClass:"time padding-10-lr margin-15-t flex-lr"},[s("li",[e._v(e._s(t.addtime_cn)+"下单")]),e._v(" "),s("li",[e._v("配送 "+e._s(t.delivery_time))])]),e._v(" "),s("ul",{staticClass:"btn-group margin-15-t padding-10-lr flex-lr"},[1==t.delivery_status?[s("li",{staticClass:"btn-item bg-warning",on:{click:function(t){e.onChangeOrderStatus(i,"delivery_assign")}}},[e._v("抢单")])]:2==t.delivery_status||3==t.delivery_status?[1==t.transfer_delivery_status?[s("li",{staticClass:"btn-item bg-danger",on:{click:function(t){e.onChangeOrderStatus(i,"direct_transfer_refuse")}}},[e._v("拒绝转单")]),e._v(" "),s("li",{staticClass:"btn-item bg-primary",on:{click:function(t){e.onChangeOrderStatus(i,"direct_transfer_agree")}}},[e._v("接受转单")])]:[t.accept_mobile?s("li",{staticClass:"btn-item bg-warning",on:{click:function(s){e.util.jsTel(t.accept_mobile)}}},[e._v("联系顾客")]):e._e(),e._v(" "),2==t.delivery_status?s("li",{staticClass:"btn-item bg-primary",on:{click:function(t){e.onChangeOrderStatus(i,"delivery_instore")}}},[e._v("确认取货")]):s("li",{staticClass:"btn-item bg-primary",on:{click:function(t){e.onChangeOrderStatus(i,"delivery_success")}}},[e._v("确认送达")])]]:e._e()],2),e._v(" "),1==t.is_pay?s("div",["delivery"!=t.pay_type?s("div",{staticClass:"have-pay"}):"delivery"==t.pay_type?s("div",{staticClass:"delivery-pay"}):e._e()]):e._e()])}))],1)],1)})),e._v(" "),e.failedTips.show?s("failed-tips",{attrs:{failedTips:e.failedTips}}):e._e()],1),e._v(" "),s("van-dialog",{attrs:{"show-cancel-button":"",confirmButtonText:"确认送达"},on:{confirm:function(t){e.onChangeOrderStatus(e.code.orderIndex,"delivery_success")},cancel:function(t){e.code.codeShow=!1}},model:{value:e.code.codeShow,callback:function(t){e.$set(e.code,"codeShow",t)},expression:"code.codeShow"}},[s("van-field",{attrs:{placeholder:"输入收货码","input-align":"center",readonly:""}}),e._v(" "),s("van-field",{attrs:{placeholder:"请输入收货码"},model:{value:e.code.value,callback:function(t){e.$set(e.code,"value",t)},expression:"code.value"}})],1)],1)},staticRenderFns:[]};var d=s("VU/8")(c,l,!1,function(e){s("lAkm")},null,null);t.default=d.exports},lAkm:function(e,t){}});